<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Gemini 챗봇</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .chat-box { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; }
    textarea { width: 100%; padding: 10px; margin-bottom: 10px; }
    button { padding: 8px 15px; cursor: pointer; }
    .reset { background-color: #f44336; color: white; border: none; }
    .chat-history { margin-top: 20px; }
    .message { margin-bottom: 10px; padding: 10px; border-left: 4px solid #007bff; background: #f1f1f1; }
    .answer { border-color: #4CAF50; background: #e8f5e9; }
  </style>
</head>
<body>
  <h1>Gemini 챗봇</h1>

  <div class="chat-box">
    <textarea id="question" placeholder="질문을 입력하세요..." required></textarea>
    <button onclick="sendQuestion()">전송</button>
    <button class="reset" onclick="resetChat()">새로고침</button>
    <p>현재 멀티턴 횟수: <span id="turn-count">0</span>/5</p>
  </div>

  <div class="chat-history" id="chat-history"></div>

  <script>
    const API_URL = "https://geminitest-q151.onrender.com/ask";  // 실제 주소로 변경
    let sessionId = null;
    let history = [];

    function updateHistoryDisplay() {
      const container = document.getElementById("chat-history");
      container.innerHTML = "";
      let turn = 0;
      history.forEach((item, i) => {
        const div = document.createElement("div");
        div.className = "message" + (item.type === "answer" ? " answer" : "");
        div.textContent = item.content;
        container.appendChild(div);
        if (item.type === "answer") turn++;
      });
      document.getElementById("turn-count").textContent = turn;
    }

    async function sendQuestion() {
      const question = document.getElementById("question").value.trim();
      if (!question || history.length >= 10) return;

      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          question: question,
          session_id: sessionId,
          history: history
        })
      });

      const data = await response.json();
      sessionId = data.session_id;
      history = data.history;
      document.getElementById("question").value = "";
      updateHistoryDisplay();
    }

    function resetChat() {
      sessionId = null;
      history = [];
      updateHistoryDisplay();
    }

    // 초기화
    updateHistoryDisplay();
  </script>
</body>
</html>
